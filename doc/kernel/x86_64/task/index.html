<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="API documentation for the Rust `task` mod in crate `kernel`."><meta name="keywords" content="rust, rustlang, rust-lang, task"><title>kernel::x86_64::task - Rust</title><link rel="stylesheet" type="text/css" href="../../../normalize.css"><link rel="stylesheet" type="text/css" href="../../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../../../dark.css"><link rel="stylesheet" type="text/css" href="../../../light.css" id="themeStyle"><script src="../../../storage.js"></script><noscript><link rel="stylesheet" href="../../../noscript.css"></noscript><link rel="shortcut icon" href="../../../favicon.ico"><style type="text/css">#crate-search{background-image:url("../../../down-arrow.svg");}</style></head><body class="rustdoc mod"><!--[if lte IE 8]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu">&#9776;</div><a href='../../../kernel/index.html'><div class='logo-container'><img src='../../../rust-logo.png' alt='logo'></div></a><p class='location'>Module task</p><div class="sidebar-elems"><div class="block items"><ul><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#functions">Functions</a></li></ul></div><p class='location'><a href='../../index.html'>kernel</a>::<wbr><a href='../index.html'>x86_64</a></p><script>window.sidebarCurrent = {name: 'task', ty: 'mod', relpath: '../'};</script><script defer src="../sidebar-items.js"></script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!"><img src="../../../brush.svg" width="18" alt="Pick another theme!"></button><div id="theme-choices"></div></div><script src="../../../theme.js"></script><nav class="sub"><form class="search-form js-only"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><a id="settings-menu" href="../../../settings.html"><img src="../../../wheel.svg" width="18" alt="Change settings"></a></div></form></nav><section id="main" class="content"><h1 class='fqn'><span class='out-of-band'><span id='render-detail'><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class='inner'>&#x2212;</span>]</a></span><a class='srclink' href='../../../src/kernel/x86_64/task.rs.html#1-321' title='goto source code'>[src]</a></span><span class='in-band'>Module <a href='../../index.html'>kernel</a>::<wbr><a href='../index.html'>x86_64</a>::<wbr><a class="mod" href=''>task</a></span></h1><h2 id='structs' class='section-header'><a href="#structs">Structs</a></h2>
<table><tr class='module-item'><td><a class="struct" href="struct.ContextSwitchFrame.html" title='kernel::x86_64::task::ContextSwitchFrame struct'>ContextSwitchFrame</a></td><td class='docblock-short'><p>This is the layout of the stack that we expect to be present when we switch to a task. It is
created both in preparation for initial task entry, and when we're switching away from a task.
We use the C ABI here because we access this structure from assembly.</p>
</td></tr><tr class='module-item'><td><a class="struct" href="struct.Task.html" title='kernel::x86_64::task::Task struct'>Task</a></td><td class='docblock-short'><p>This is the representation of a task on x86_64. It's basically just keeps information about the
current instruction pointer and the stack, as all other registers are preserved on the task
stack when it's suspended.</p>
</td></tr></table><h2 id='enums' class='section-header'><a href="#enums">Enums</a></h2>
<table><tr class='module-item'><td><a class="enum" href="enum.TaskCreationError.html" title='kernel::x86_64::task::TaskCreationError enum'>TaskCreationError</a></td><td class='docblock-short'></td></tr></table><h2 id='functions' class='section-header'><a href="#functions">Functions</a></h2>
<table><tr class='module-item'><td><a class="fn" href="fn.context_switch.html" title='kernel::x86_64::task::context_switch fn'>context_switch</a></td><td class='docblock-short'><p>Perform a context-switch between the currently running task, <code>old</code>, and a new task, <code>new</code>. This
function is fairly fragile as it may not always return (in the case of the new task never
having been run before, in which case this returns into the trampoline instead of back up the
kernel callstack), and so we have to be very careful to drop any locks we hold before &quot;returning&quot;</p>
</td></tr><tr class='module-item'><td><a class="fn" href="fn.decode_capabilities.html" title='kernel::x86_64::task::decode_capabilities fn'>decode_capabilities</a></td><td class='docblock-short'><p>Decode a capability stream (as found in a task's image) into a set of capabilities as they're
represented in the kernel. For the format that's being decoded here, refer to the
<code>(3.1) Userspace/Capabilities</code> section of the Book.</p>
</td></tr><tr class='module-item'><td><a class="fn" href="fn.do_context_switch.html" title='kernel::x86_64::task::do_context_switch fn'>do_context_switch</a><a title='unsafe function' href='#'><sup>⚠</sup></a></td><td class='docblock-short'><p>Do the actual context switch: save the context of the old task on its kernel stack, switch
to the new task's kernel stack, restore its context and return. The only non-trivial part
of this is the returning - for tasks that have run before, we simply work our way back up
the kernel callstack and return to userspace from the syscall handler. However, for tasks
that have never been run before, the stack frames leading back up to the handler aren't
there, and so we manually insert a return to a kernel-space usermode trampoline that
enters userspace for the first time in the initial stack frame, which is what the context
switch returns to.</p>
</td></tr><tr class='module-item'><td><a class="fn" href="fn.drop_to_usermode.html" title='kernel::x86_64::task::drop_to_usermode fn'>drop_to_usermode</a></td><td class='docblock-short'><p>Drop into usermode into the given task. This permanently migrates from the kernel's initial
stack (the one reserved in <code>.bss</code> and used during kernel initialization).</p>
</td></tr><tr class='module-item'><td><a class="fn" href="fn.task_entry_trampoline.html" title='kernel::x86_64::task::task_entry_trampoline fn'>task_entry_trampoline</a><a title='unsafe function' href='#'><sup>⚠</sup></a></td><td class='docblock-short'></td></tr></table></section><section id="search" class="content hidden"></section><section class="footer"></section><script>window.rootPath = "../../../";window.currentCrate = "kernel";</script><script src="../../../aliases.js"></script><script src="../../../main.js"></script><script defer src="../../../search-index.js"></script></body></html>